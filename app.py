#!env/bin/python
from flask.app import Flask

from logic.apps.admin.config.app import setup_repos, setup_repos_default
from logic.apps.admin.config.logger import setup_loggers
from logic.apps.admin.config.rest import setup_rest
from logic.apps.admin.config.sqlite import setup_sqlite
from logic.apps.admin.config.variables import Vars, setup_vars
from logic.apps.agents.services.agent_checker import start_agent_thread
from logic.apps.works.services.work_runner import start_runner_thread
from logic.libs.logger.logger import logger
from logic.libs.variables.variables import get_var

app = Flask(__name__)

setup_vars()
setup_loggers()
setup_rest(app)

setup_sqlite()
start_runner_thread()
start_agent_thread()
setup_repos_default()
setup_repos()

logger().info("""

                      ,^(]$%&&&&%$](+,`                                                                                                               
                  ,)$#@@@@@@@@@@@@@@@@#$("                                                                                                            
               '(&@@@@#####@@@@@@#####@@@@&('                                                                                                         
             ,]#@@###@@@@@%]\+++/]#@@@@###@@#$,                                             .!?(]>                                                    
           `]#@@##@@@@@@%!,,,,,,,,,?#@@@@@##@@#]`                                       ,)$@##@%(`                                                    
          :&@@##@@@@@@@$,,,,,,,,,,,,:#@@@@@@##@@#:                                   `)&$):.]]`                                                       
         ?#@@#@@@@@@@@$,,,,,,,,,,,,,,:#@@@@@@@#@@#?                                `]$>`  :#$                                                         
        ?#@@#@@@@@@@@@$,,,,,,,,,,,,,,~&@@@@@@@@#@@#\                              ^$~    ;@#`                                                         
       :#@@#@@@@@@@@@@@\,,,,,,,,,,,,,]@@@@@@@@@@#@@#!                            ]?     '@@*                                                          
      `%@@#@@@@@@@@@@%,,,,,,,,,,,,,,,!]@@@@@@@@@@#@@&`                          ]:      $@#                       `                                   
      ?@@##@@@@@@@@@@#:,,,,,,,,,,,,,,,]@@@@@@@@@@##@@/                         !*      ,@@\                     :],                                   
      %@@#@@@@@@@@@@@@#^,,,,,:?:,,,,,]@@@@@@@@@@@@#@@%                         ]       $@#                    `$]                                     
     .#@@#@@@@@@@@@@@@@@:,,:+\+\^",,\@@@@@@@@@@@@@#@@#'                        $      :@@^                    `/                                      
     "#@@#@@@@@@@@@@@@@@&:,,,,,,,,,+@@@@@@@@@@@@@@#@@#:                        ]`     &@$       `"!!' ':      '`   `::   `:!`   `:!'       `:!,       
     ~#@@#@@@@@@@@@@@@@@@%,,,,,,,,,#@@@@@@@@@@@@@@#@@#:                        .]`   ?@#`     ?\!,'+#@@!   ,(##` `*)@@:")/%@# ,(/$@@,    ,(/)#@&      
     '#@@#@@@@@@@@@@@@@@@%,,,,,,,,,%@@@@@@@@@@@@@@#@@#'              ,!,         >+;;@@(,   >#!    '@@:   :^@#.  , /@#/!  ]@%+!  /@#    )%   ]@#`     
      %@@#@@@@@@@@@@@@@#]],,,,,,,,,]]&@@@@@@@@@@@@#@@&          `^+;:.              &@^    ]@)    '#@)    `#@!     #@#.   #@%'  `@@:   )@]>?(]:       
      \@@##@@@@@@&$]);",/@]",,,,,:$@(,,!\]$%#@@@@#@@@(        +]^                  $@*    ^@@`   :#@#     ]@$     (@#.   (@@'   $@]   '@@'            
      `&@@#@#$]^,,,,,,,,#@@#]/\($@@@#,,,,,,,,:/$##@@#.      >&^                   ]@^     ]@@`  )=#@]  ` .@@; `` .@@:   '@@!   '@@` ` \@@'    :       
       !#@@%:,,,,,,,,,,+@@@??%@$;]@@@*,,,,,,,,,!%@@#>      $@'                   $#"      !@@%]]' #@&)?  ;@@]\^  $@]    %@]    ;@@\?! ~@@#(\]('       
        \#@@%;,,,,,,,,,]@@@!:]$)"]@@@$,,,,,,,,?&@@@]      $@(                  .%$`        :)>`   '(=`    ?(!    );    `(^      ?)!    '?(/!`         
         ?#@@#]:,,,,,,,]@@@#@@@@@@@@@],,,,,,:]#@@@]      '@@^                 \%:                                                                     
          !#@@#%(:,,,,,,%@@@@@@@@@@@%,,,,,:(&@@@@]       ,@@]               >$^                                                                       
           `]#@@##]^",,,~$@@@@@@@@@$~,,:/]&#@@@#/         %@@)           !(]:                                                                         
             ,$#@@@#&$]\:,(#@@@@@#(!/]$##@@@@@&:          `]#@@$]\?\)]]](:                                                                            
               ,]#@@@@####&%##########@@@@@@#]`              .:^>>^:,`                                                                                
                  :]%#@@@@@@@@@@@@@@@@@@@@#$,                                                                                                         
                     `:]#@@@@@@@@@@@@@@@@$:                                                                                                           
                        :#@@@@@@@@@@@@#$:                                                                                                             
                         $@@@@@@@@@@#],                                                                                                               
                         $@@@@@@@#%?`                                                                                                                 
                         $@@@@@&(,                                                                                                                    
                         $@#%(,                                                                                                                       
                         \*'                                                                                                                          
                                                                                                                                                                        
""")
logger().info("> Jaimeeehhhh...!!!")
logger().info("> ¿Si, señora?")

if __name__ == "__main__":
    flask_host = get_var(Vars.PYTHON_HOST)
    flask_port = int(get_var(Vars.PYTHON_PORT))

    app.run(host=flask_host, port=flask_port, debug=False)
